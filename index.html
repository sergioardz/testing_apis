<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Testing APIs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


</head>
<style>
    #map {
        height: 300px;
        width: 450px;
    }

    #results1 {
        margin: auto;
        max-width: 600px;
    }
</style>

<body>
    <div id="buttons"><br>
        <button id="location">Location</button>
        <button id="select">Select</button>
        <button id="current">Current</button>
        <button id="random">Random</button>
        <button id="beerhunt">Beer Hunt</button>
    </div>
    <div id="results1">
        <div id="map"></div>
    </div>
    <div id="results2"></div>
    <div id="results3"></div>
    <div class="container" style="width:600px;">
        <h2>Make your beer choice!</h2><br /><br />
        <select name="category" id="category" class="form-control input-lg">
            <option value="">Select category</option>
        </select>
        <br />
        <select name="type" id="type" class="form-control input-lg">
            <option value="">Select type</option>
        </select>
        <br />
        <select name="brewery" id="brewery" class="form-control input-lg">
            <option value="">Select brewery</option>
        </select>
        <br />
        <select name="beer" id="beer" class="form-control input-lg">
            <option value="">Select beer</option>
        </select>
    </div>
    <div id="results4"></div>
    <div id="wrapper"></div>
    <div id="wrapper2"></div>
    <div id="wrapper3"></div>


    <!-- <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDw8hFnyQv4weAe34Uhrba3H22o52PYXKc&callback=initMap&libraries=places"
        async defer></script> -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDw8hFnyQv4weAe34Uhrba3H22o52PYXKc&libraries=places"
        async defer></script>
    <script>

        // Current with IP
        var queryURLIP = "https://api.ipify.org?";
        // console.log(queryURLIP);

        const apiKeyIP = "at_knMW8P4hXMF72fVn0z8jG2ZnwPsAy";

        var myLat;
        var myLng;
        var unit = "M";

        $("#current").on("click", getcurrentIP);

        function getcurrentIP() {
            $.ajax({
                url: queryURLIP, method: "GET"
            })
                .done(function (response) {
                    console.log(response);
                    var currentIP = response;
                    $.ajax({
                        url: "https://geo.ipify.org/api/v1",
                        dataType: "json",
                        data: { apiKey: apiKeyIP, ipAddress: currentIP }
                    })
                        .done(function (response) {
                            console.log("City: " + response.location.city);
                            console.log("Latitude : " + response.location.lat);
                            console.log("Longitude : " + response.location.lng);
                            $("#results2").append("<br><p>Current Location: " + response.location.city + ", " + response.location.region + ", " + response.location.country) + "</p><br>";
                            console.log(response);
                            myLat = response.location.lat;
                            myLng = response.location.lng;
                            $.getJSON("Locations.json", function (response) {
                                for (i = 0; i < response.data.length; i++) {
                                    var D = distance(myLat, myLng, response.data[i].latitude, response.data[i].longitude, unit);
                                    // console.log(D);
                                    // console.log("Distance from Current Location to " + response.data[i].name + " is " + Math.trunc(D) + " miles");
                                    response.data[i].distAway = D;
                                }
                                // console.log(response);
                                var minDaway = Number.POSITIVE_INFINITY;
                                var minDawayLoc;
                                for (i = 0; i < response.data.length; i++) {
                                    if (response.data[i].distAway < minDaway) {
                                        minDaway = response.data[i].distAway;
                                        minDawayLoc = response.data[i].name;
                                        minDawayLity = response.data[i].locality;
                                        minDawayReg = response.data[i].region;
                                        minDawayLat = response.data[i].latitude;
                                        minDawayLng = response.data[i].longitude;
                                    }
                                }
                                console.log(minDaway);
                                console.log(minDawayLoc);
                                console.log(minDawayLity);
                                console.log(minDawayReg);
                                console.log(minDawayLat);
                                console.log(minDawayLng);
                                $("#results2").append("<p>The closest location is in: " + minDawayLity + ", " + minDawayReg + "</p>");
                                var map;
                                var service;
                                var infowindow;
                                var myLatLng = { lat: minDawayLat, lng: minDawayLng };
                                var auxquery = minDawayLoc + " " + minDawayLity + ", " + minDawayReg;
                                console.log(auxquery);
                                var closeLoc = new google.maps.LatLng(minDawayLat, minDawayLng);
                                infowindow = new google.maps.InfoWindow();
                                map = new google.maps.Map(
                                    document.getElementById("map"), { center: closeLoc, zoom: 9 });
                                var marker = new google.maps.Marker({
                                    position: myLatLng,
                                    map: map,
                                    title: auxquery
                                });

                                var weatherkey = "3eaf6100e9b1bdb38f073d8f5016bcf2";
                                // var city = "El Paso";
                                var latitud = minDawayLat;
                                var longitud = minDawayLng;
                                var url5 = "https://api.openweathermap.org/data/2.5/forecast";
                                var urlHoy = "https://api.openweathermap.org/data/2.5/weather";
                                var hoy = moment(new Date()).format("MMM DD YYYY");
                                var hoyDayOfWeek = moment(hoy).format('dddd');
                                var hcity, hlatitud, hlongitud, htemp, hcountry, hhumidity, hdesc, hicon, hIconLocation = "";
                                var t1, t2 = 0;

                                // Getting today's forecast
                                $.ajax({
                                    url: urlHoy, //API Call
                                    dataType: "json",
                                    type: "GET",
                                    async: false,
                                    data: {
                                        lat: latitud,
                                        lon: longitud,
                                        appid: weatherkey,
                                        units: "metric"
                                    },
                                    success: function (datahoy) {
                                        console.log('Received dataHoy:', datahoy)
                                        hcity = datahoy.name;
                                        hlatitud = datahoy.coord.lat;
                                        hlongitud = datahoy.coord.lon;
                                        hcountry = datahoy.sys.country;
                                        htemp = Math.round(datahoy.main.temp) + "Â°C";
                                        hhumidity = datahoy.main.humidity + "%";
                                        hdesc = datahoy.weather[0].description;
                                        hicon = datahoy.weather[0].icon;
                                        hIconLocation = "https://openweathermap.org/img/w/" + hicon + ".png";
                                    }
                                });

                                tSummary = {
                                    header: [hoy, hoyDayOfWeek, hcity, hlatitud, hlongitud, hcountry, htemp, hhumidity, hdesc, hIconLocation],
                                    day: [],
                                    maxi: [],
                                    mini: [],
                                    iconos: []
                                };

                                var row1 = $("<tr>").append(
                                    $("<td>").text(tSummary.header[2] + ", " + tSummary.header[5])
                                );
                                var row2 = $("<tr>").append(
                                    $("<td>").text(tSummary.header[1]),
                                    $("<td>").text(tSummary.header[0])
                                );
                                var icon1 = "<img src=" + hIconLocation + " />";
                                var row3 = $("<tr>").append(
                                    $("<td>").text(tSummary.header[6]),
                                );
                                $("#wrapper").append(row1, row2, icon1, row3);

                                // $('#t0DayOfWeek').text(tSummary.header[1]);
                                // $('#t0Date').text(tSummary.header[0]);
                                // $('#tCity').text(tSummary.header[2] + ", " + tSummary.header[5]);
                                // $('#t0temp').text(tSummary.header[6]);
                                // $("#t0Icon").attr('src', hIconLocation);


                                // Getting info from 5 days in the future forecast
                                $.ajax({
                                    url: url5, //API Call
                                    dataType: "json",
                                    type: "GET",
                                    async: false,
                                    data: {
                                        lat: latitud,
                                        lon: longitud,
                                        appid: weatherkey,
                                        units: "metric",
                                        cnt: "40"
                                    },
                                    success: function (data5) {
                                        console.log('Received dataForecast:', data5)
                                        $.each(data5.list, function (index, val) {
                                            var hora = val.dt_txt.substr(val.dt_txt.length - 8);
                                            if (hora === "03:00:00") {
                                                var fday = val.dt_txt.substr(8, 2);
                                                var fmonth = val.dt_txt.substr(5, 2);
                                                var fyear = val.dt_txt.substr(0, 4);
                                                var ffecha = fmonth + "/" + fday + "/" + fyear;
                                                var fformat = "MM/DD/YYYY";
                                                var fconverted = moment(ffecha, fformat);
                                                var fDayOfWeek = moment(fconverted).format('dddd').substr(0, 3) + " " + fday;
                                                t1 = Math.round(val.main.temp_min) + "Â°C";
                                                var fhumidity = val.main.humidity + "%";
                                                var fdesc = val.weather[0].description;
                                                var ficon = val.weather[0].icon;
                                                var fIconLocation = "https://openweathermap.org/img/w/" + ficon + ".png";
                                                tSummary.day.push(fDayOfWeek);
                                                tSummary.iconos.push(fIconLocation);
                                            }
                                            if (hora === "15:00:00") {
                                                t2 = Math.round(val.main.temp_max) + "Â°C";
                                                if (t1 < t2) {
                                                    tSummary.maxi.push(t2);
                                                    tSummary.mini.push(t1);
                                                }
                                                else {
                                                    tSummary.maxi.push(t1);
                                                    tSummary.mini.push(t2);
                                                }
                                                t1, t2 = 0;
                                            }
                                        });
                                    }

                                })

                                var row4 = $("<tr>").append(
                                    $("<td>").text("Date"),
                                    $("<td>").text(tSummary.day[0]),
                                    $("<td>").text(tSummary.day[1]),
                                    $("<td>").text(tSummary.day[2]),
                                    $("<td>").text(tSummary.day[3]),
                                    $("<td>").text(tSummary.day[4]),
                                );
                                var icon2 = "<img src=" + tSummary.iconos[0] + " />";
                                var icon3 = "<img src=" + tSummary.iconos[1] + " />";
                                var icon4 = "<img src=" + tSummary.iconos[2] + " />";
                                var icon5 = "<img src=" + tSummary.iconos[3] + " />";
                                var icon6 = "<img src=" + tSummary.iconos[4] + " />";

                                var row5 = $("<tr>").append(
                                    $("<td>").text("FC"),
                                    $("<td>").append(icon2),
                                    $("<td>").append(icon3),
                                    $("<td>").append(icon4),
                                    $("<td>").append(icon5),
                                    $("<td>").append(icon6),
                                );
                                var row6 = $("<tr>").append(
                                    $("<td>").text("Max"),
                                    $("<td>").text(tSummary.maxi[0]),
                                    $("<td>").text(tSummary.maxi[1]),
                                    $("<td>").text(tSummary.maxi[2]),
                                    $("<td>").text(tSummary.maxi[3]),
                                    $("<td>").text(tSummary.maxi[4]),
                                );
                                var row7 = $("<tr>").append(
                                    $("<td>").text("Min"),
                                    $("<td>").text(tSummary.mini[0]),
                                    $("<td>").text(tSummary.mini[1]),
                                    $("<td>").text(tSummary.mini[2]),
                                    $("<td>").text(tSummary.mini[3]),
                                    $("<td>").text(tSummary.mini[4]),
                                );

                                $("#wrapper2").append(row4, row5, row7, row6);

                                // Printing info from 5 days in the future forecast
                                // $('#t1DayOfWeek').text(tSummary.day[0]);
                                // $("#t1Icon").attr("src", tSummary.iconos[0]); 
                                // $('#t1maxtemp').text(tSummary.maxi[0]);
                                // $('#t1mintemp').text(tSummary.mini[0]);

                                // $('#t2DayOfWeek').text(tSummary.day[1]);
                                // $("#t2Icon").attr("src", tSummary.iconos[1]);
                                // $('#t2maxtemp').text(tSummary.maxi[1]);
                                // $('#t2mintemp').text(tSummary.mini[1]);

                                // $('#t3DayOfWeek').text(tSummary.day[2]);
                                // $("#t3Icon").attr("src", tSummary.iconos[2]);
                                // $('#t3maxtemp').text(tSummary.maxi[2]);
                                // $('#t3mintemp').text(tSummary.mini[2]);

                                // $('#t4DayOfWeek').text(tSummary.day[3]);
                                // $("#t4Icon").attr("src", tSummary.iconos[3]);
                                // $('#t4maxtemp').text(tSummary.maxi[3]);
                                // $('#t4mintemp').text(tSummary.mini[3]);

                                // $('#t5DayOfWeek').text(tSummary.day[4]);
                                // $("#t5Icon").attr("src", tSummary.iconos[4]);
                                // $('#t5maxtemp').text(tSummary.maxi[4]);
                                // $('#t5mintemp').text(tSummary.mini[4]);

                                console.log(tSummary);
                                getRestaurant(tSummary.header[2], tSummary.header[5]);

                                // var request = {
                                //     query: "Oskar Blues Austin, Texas",
                                //     fields: ["name", "geometry"],
                                // };
                                // service = new google.maps.places.PlacesService(map);
                                // service.findPlaceFromQuery(request, function (results, status) {
                                //     if (status === google.maps.places.PlacesServiceStatus.OK) {
                                //         for (var i = 0; i < results.length; i++) {
                                //             createMarker(results[i]);
                                //         }
                                //         map.setCenter(results[0].geometry.location);
                                //     }
                                // });

                            })

                        })
                })
        }

        function distance(lat1, lon1, lat2, lon2, unit) {
            if ((lat1 == lat2) && (lon1 == lon2)) {
                return 0;
            }
            else {
                var radlat1 = Math.PI * lat1 / 180;
                var radlat2 = Math.PI * lat2 / 180;
                var theta = lon1 - lon2;
                var radtheta = Math.PI * theta / 180;
                var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                if (dist > 1) {
                    dist = 1;
                }
                dist = Math.acos(dist);
                dist = dist * 180 / Math.PI;
                dist = dist * 60 * 1.1515;
                if (unit == "K") { dist = dist * 1.609344 }
                if (unit == "N") { dist = dist * 0.8684 }
                return dist;
            }
        }

        // // Current with Google Maps

        // var map;
        // var service;
        // var infowindow;
        // var auxquery = minDawayLoc + " " + minDawayLity + ", " + minDawayReg;


        // function initMap() {
        //     var closeLoc = new google.maps.LatLng(minDawayLat, minDawayLng);
        //     infowindow = new google.maps.InfoWindow();
        //     map = new google.maps.Map(
        //         document.getElementById("map"), { center: closeLoc, zoom: 10 });
        //     var request = {
        //         query: auxquery,
        //         fields: ["name", "geometry"],
        //     };
        //     service = new google.maps.places.PlacesService(map);
        //     service.findPlaceFromQuery(request, function (results, status) {
        //         if (status === google.maps.places.PlacesServiceStatus.OK) {
        //             for (var i = 0; i < results.length; i++) {
        //                 createMarker(results[i]);
        //             }
        //             map.setCenter(results[0].geometry.location);
        //         }
        //     });
        // }
        // function createMarker(place) {
        //     var marker = new google.maps.Marker({
        //         map: map,
        //         position: place.geometry.location
        //     });
        //     google.maps.event.addListener(marker, 'click', function () {
        //         infowindow.setContent(place.name);
        //         infowindow.open(map, this);
        //     });
        // }


        $("#location").click(function () {
            if (navigator.geolocation) navigator.geolocation.getCurrentPosition(function (position) {
                console.log(position);
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                console.log("Latitude: " + lat);
                console.log("Longitude: " + lng);
                $.get("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + position.coords.latitude + "," + position.coords.longitude + "&sensor=false&key=AIzaSyDw8hFnyQv4weAe34Uhrba3H22o52PYXKc", function (data) {
                    console.log(data);
                    console.log(data.results[6].formatted_address);
                })
            });
            else
                console.log("geolocation is not supported");
        });


        // Random

        var allLocations = [];

        $("#random").on("click", getRandom);

        function getRandom() {
            $("#results3").empty();
            // $.getJSON("Locations.json", function (response) {
            //     console.log(response.data[0].id);
            // })
            $.getJSON("alldata.json", function (response) {
                console.log(response.data.length);
                for (i = 0; i < response.data.length; i++) {
                    allLocations.push(response.data[i].id);
                }
                console.log(allLocations.length);
                var randomIndex = Math.floor(Math.random() * allLocations.length);
                var randomID = allLocations[randomIndex];
                console.log(randomID);
                $("#results3").append("<p>Selected beer: " + response.data[randomIndex].name + "</p>");
                if (response.data[randomIndex].hasOwnProperty("labels")) {
                    $("#results3").append("<img src=" + response.data[randomIndex].labels.medium + ">");
                }
                else {
                    $("#results3").append("<p>No label to display</p>");
                }
                if (response.data[randomIndex].hasOwnProperty("description")) {
                    $("#results3").append("<p>Beer Description: " + response.data[randomIndex].description + "</p>");
                }
                else {
                    $("#results3").append("<p>Beer Description: Not available");
                }
                if (response.data[randomIndex].hasOwnProperty("style")) {
                    $("#results3").append("<p>Beer Category: " + response.data[randomIndex].style.category.name + "</p>");
                    $("#results3").append("<p>Beer Style: " + response.data[randomIndex].style.name + "</p>");
                    $("#results3").append("<p>Style description: " + response.data[randomIndex].style.description + "</p>");
                }
                else {
                    $("#results3").append("<p>Beer Category: Not available</p>");
                    $("#results3").append("<p>Beer Style: Not available</p>");
                    $("#results3").append("<p>Style description: Not available</p>");
                }
                // if (response.data[randomIndex].hasOwnProperty("description")) {
                //     $("#results3").append("<p>Beer Description: " + response.data[randomIndex].description + "</p>");
                // }
                // else {
                //     $("#results3").append("<p>Beer Description: Not available");
                // }
                if (response.data[randomIndex].hasOwnProperty("abv")) {
                    $("#results3").append("<p>Alcohol by volume: " + response.data[randomIndex].abv + "%</p>");
                }
                else {
                    $("#results3").append("<p>Alcohol by volume: Not available");
                }
                if (response.data[randomIndex].hasOwnProperty("available")) {
                    $("#results3").append("<p>Availability: " + response.data[randomIndex].available.name + "." + response.data[randomIndex].available.description + "</p>");
                }
                else {
                    $("#results3").append("<p>Availability: Not defined");
                }
                console.log("Beer name: " + response.data[randomIndex].name);
                console.log("Category: " + response.data[randomIndex].style.category.name);
                console.log("Style: " + response.data[randomIndex].style.name);
                // var selectedBeer = $("<p>").text("Randomly selected beer: " + response.data[randomIndex].name);
                // $("#results3").append(selectedBeer);
                // if (response.data[randomIndex].hasOwnProperty("labels")) {
                //     $("#results3").append("<img src=" + response.data[randomIndex].labels.medium + ">");
                // }
                // else {
                //     $("#results3").append("<p>No label to display</p>");
                // }
                $.getJSON("master.json", function (master) {
                    console.log(master.data.length);
                    for (i = 1; i < master.data.length; i++) {
                        if (randomID === master.data[i].C) {
                            // var locationID = master.data[i].G;
                            var breweryID = master.data[i].F;
                            console.log("Brewery ID: " + breweryID);
                            // console.log("Location ID: " + locationID);
                        }
                    }
                    $.getJSON("breweries.json", function (response) {
                        // console.log(response.data.length);
                        for (i = 0; i < response.data.length; i++) {
                            if (breweryID === response.data[i].id) {
                                console.log("Brewery Name: " + response.data[i].name);
                                if (response.data[i].nloc > 1) {
                                    locationID = response.data[i].locations[Math.floor(Math.random() * response.data[i].nloc)];
                                    console.log("Location ID: " + locationID);
                                }
                                else {
                                    locationID = response.data[i].locations;
                                    console.log("Location ID: " + locationID);
                                }
                                $.getJSON("Locations.json", function (response) {
                                    for (i = 0; i < response.data.length; i++) {
                                        if (locationID === response.data[i].id) {
                                            console.log(response.data[i].locality);
                                            console.log(response.data[i].region);
                                            console.log(response.data[i].latitude);
                                            console.log(response.data[i].longitude);
                                            selecLat = response.data[i].latitude;
                                            selecLng = response.data[i].longitude;
                                            $("#results3").append("<p>This beer you can find in: " + response.data[i].locality + ", " + response.data[i].region + "</p>");
                                        }
                                    }
                                    var weatherkey = "3eaf6100e9b1bdb38f073d8f5016bcf2";
                                    // var city = "El Paso";
                                    var latitud = selecLat;
                                    var longitud = selecLng;
                                    var url5 = "https://api.openweathermap.org/data/2.5/forecast";
                                    var urlHoy = "https://api.openweathermap.org/data/2.5/weather";
                                    var hoy = moment(new Date()).format("MMM DD YYYY");
                                    var hoyDayOfWeek = moment(hoy).format('dddd');
                                    var hcity, hlatitud, hlongitud, htemp, hcountry, hhumidity, hdesc, hicon, hIconLocation = "";
                                    var t1, t2 = 0;

                                    // Getting today's forecast
                                    $.ajax({
                                        url: urlHoy, //API Call
                                        dataType: "json",
                                        type: "GET",
                                        async: false,
                                        data: {
                                            lat: latitud,
                                            lon: longitud,
                                            appid: weatherkey,
                                            units: "metric"
                                        },
                                        success: function (datahoy) {
                                            console.log('Received dataHoy:', datahoy)
                                            hcity = datahoy.name;
                                            hlatitud = datahoy.coord.lat;
                                            hlongitud = datahoy.coord.lon;
                                            hcountry = datahoy.sys.country;
                                            htemp = Math.round(datahoy.main.temp) + "Â°C";
                                            hhumidity = datahoy.main.humidity + "%";
                                            hdesc = datahoy.weather[0].description;
                                            hicon = datahoy.weather[0].icon;
                                            hIconLocation = "https://openweathermap.org/img/w/" + hicon + ".png";
                                        }
                                    });

                                    tSummary = {
                                        header: [hoy, hoyDayOfWeek, hcity, hlatitud, hlongitud, hcountry, htemp, hhumidity, hdesc, hIconLocation],
                                        day: [],
                                        maxi: [],
                                        mini: [],
                                        iconos: []
                                    };

                                    var row1 = $("<tr>").append(
                                        $("<td>").text(tSummary.header[2] + ", " + tSummary.header[5])
                                    );
                                    var row2 = $("<tr>").append(
                                        $("<td>").text(tSummary.header[1]),
                                        $("<td>").text(tSummary.header[0])
                                    );
                                    var icon1 = "<img src=" + hIconLocation + " />";
                                    var row3 = $("<tr>").append(
                                        $("<td>").text(tSummary.header[6]),
                                    );
                                    $("#wrapper").append(row1, row2, icon1, row3);

                                    // $('#t0DayOfWeek').text(tSummary.header[1]);
                                    // $('#t0Date').text(tSummary.header[0]);
                                    // $('#tCity').text(tSummary.header[2] + ", " + tSummary.header[5]);
                                    // $('#t0temp').text(tSummary.header[6]);
                                    // $("#t0Icon").attr('src', hIconLocation);


                                    // Getting info from 5 days in the future forecast
                                    $.ajax({
                                        url: url5, //API Call
                                        dataType: "json",
                                        type: "GET",
                                        async: false,
                                        data: {
                                            lat: latitud,
                                            lon: longitud,
                                            appid: weatherkey,
                                            units: "metric",
                                            cnt: "40"
                                        },
                                        success: function (data5) {
                                            console.log('Received dataForecast:', data5)
                                            $.each(data5.list, function (index, val) {
                                                var hora = val.dt_txt.substr(val.dt_txt.length - 8);
                                                if (hora === "03:00:00") {
                                                    var fday = val.dt_txt.substr(8, 2);
                                                    var fmonth = val.dt_txt.substr(5, 2);
                                                    var fyear = val.dt_txt.substr(0, 4);
                                                    var ffecha = fmonth + "/" + fday + "/" + fyear;
                                                    var fformat = "MM/DD/YYYY";
                                                    var fconverted = moment(ffecha, fformat);
                                                    var fDayOfWeek = moment(fconverted).format('dddd').substr(0, 3) + " " + fday;
                                                    t1 = Math.round(val.main.temp_min) + "Â°C";
                                                    var fhumidity = val.main.humidity + "%";
                                                    var fdesc = val.weather[0].description;
                                                    var ficon = val.weather[0].icon;
                                                    var fIconLocation = "https://openweathermap.org/img/w/" + ficon + ".png";
                                                    tSummary.day.push(fDayOfWeek);
                                                    tSummary.iconos.push(fIconLocation);
                                                }
                                                if (hora === "15:00:00") {
                                                    t2 = Math.round(val.main.temp_max) + "Â°C";
                                                    if (t1 < t2) {
                                                        tSummary.maxi.push(t2);
                                                        tSummary.mini.push(t1);
                                                    }
                                                    else {
                                                        tSummary.maxi.push(t1);
                                                        tSummary.mini.push(t2);
                                                    }
                                                    t1, t2 = 0;
                                                }
                                            });
                                        }

                                    })

                                    var row4 = $("<tr>").append(
                                        $("<td>").text("Date"),
                                        $("<td>").text(tSummary.day[0]),
                                        $("<td>").text(tSummary.day[1]),
                                        $("<td>").text(tSummary.day[2]),
                                        $("<td>").text(tSummary.day[3]),
                                        $("<td>").text(tSummary.day[4]),
                                    );
                                    var icon2 = "<img src=" + tSummary.iconos[0] + " />";
                                    var icon3 = "<img src=" + tSummary.iconos[1] + " />";
                                    var icon4 = "<img src=" + tSummary.iconos[2] + " />";
                                    var icon5 = "<img src=" + tSummary.iconos[3] + " />";
                                    var icon6 = "<img src=" + tSummary.iconos[4] + " />";

                                    var row5 = $("<tr>").append(
                                        $("<td>").text("FC"),
                                        $("<td>").append(icon2),
                                        $("<td>").append(icon3),
                                        $("<td>").append(icon4),
                                        $("<td>").append(icon5),
                                        $("<td>").append(icon6),
                                    );
                                    var row6 = $("<tr>").append(
                                        $("<td>").text("Max"),
                                        $("<td>").text(tSummary.maxi[0]),
                                        $("<td>").text(tSummary.maxi[1]),
                                        $("<td>").text(tSummary.maxi[2]),
                                        $("<td>").text(tSummary.maxi[3]),
                                        $("<td>").text(tSummary.maxi[4]),
                                    );
                                    var row7 = $("<tr>").append(
                                        $("<td>").text("Min"),
                                        $("<td>").text(tSummary.mini[0]),
                                        $("<td>").text(tSummary.mini[1]),
                                        $("<td>").text(tSummary.mini[2]),
                                        $("<td>").text(tSummary.mini[3]),
                                        $("<td>").text(tSummary.mini[4]),
                                    );

                                    $("#wrapper2").append(row4, row5, row7, row6);

                                    // Printing info from 5 days in the future forecast
                                    // $('#t1DayOfWeek').text(tSummary.day[0]);
                                    // $("#t1Icon").attr("src", tSummary.iconos[0]); 
                                    // $('#t1maxtemp').text(tSummary.maxi[0]);
                                    // $('#t1mintemp').text(tSummary.mini[0]);

                                    // $('#t2DayOfWeek').text(tSummary.day[1]);
                                    // $("#t2Icon").attr("src", tSummary.iconos[1]);
                                    // $('#t2maxtemp').text(tSummary.maxi[1]);
                                    // $('#t2mintemp').text(tSummary.mini[1]);

                                    // $('#t3DayOfWeek').text(tSummary.day[2]);
                                    // $("#t3Icon").attr("src", tSummary.iconos[2]);
                                    // $('#t3maxtemp').text(tSummary.maxi[2]);
                                    // $('#t3mintemp').text(tSummary.mini[2]);

                                    // $('#t4DayOfWeek').text(tSummary.day[3]);
                                    // $("#t4Icon").attr("src", tSummary.iconos[3]);
                                    // $('#t4maxtemp').text(tSummary.maxi[3]);
                                    // $('#t4mintemp').text(tSummary.mini[3]);

                                    // $('#t5DayOfWeek').text(tSummary.day[4]);
                                    // $("#t5Icon").attr("src", tSummary.iconos[4]);
                                    // $('#t5maxtemp').text(tSummary.maxi[4]);
                                    // $('#t5mintemp').text(tSummary.mini[4]);

                                    console.log(tSummary);
                                    getRestaurant(tSummary.header[2], tSummary.header[5]);
                                })
                            }
                        }
                    })
                })
                randomIndex = 0;
                allLocations = [];
            })
        }

        // Beer Hunt

        function getRestaurant(param1, param2) {
            var opencity = param1;
            var opencountry = param2;
            console.log(opencity, "   ", opencountry);
            var urlopentable = "https://opentable.herokuapp.com/api/restaurants";
            var x, y, x1, x2, x3, x4, x5 = 0;
            xarray = [];

            hotelSummary = {
                Price1: {
                    otId: [],
                    otName: [],
                    otCity: [],
                    otState: [],
                    otCountry: [],
                    otAddress: [],
                    otPhone: [],
                    otZip: [],
                    otImgURL: [],
                    otReserveURL: [],
                    otLat: [],
                    otLong: []
                },
                Price2: {
                    otId: [],
                    otName: [],
                    otCity: [],
                    otState: [],
                    otCountry: [],
                    otAddress: [],
                    otPhone: [],
                    otZip: [],
                    otImgURL: [],
                    otReserveURL: [],
                    otLat: [],
                    otLong: []
                },
                Price3: {
                    otId: [],
                    otName: [],
                    otCity: [],
                    otState: [],
                    otCountry: [],
                    otAddress: [],
                    otPhone: [],
                    otZip: [],
                    otImgURL: [],
                    otReserveURL: [],
                    otLat: [],
                    otLong: []
                },
                Price4: {
                    otId: [],
                    otName: [],
                    otCity: [],
                    otState: [],
                    otCountry: [],
                    otAddress: [],
                    otPhone: [],
                    otZip: [],
                    otImgURL: [],
                    otReserveURL: [],
                    otLat: [],
                    otLong: []
                },
                Price5: {
                    otId: [],
                    otName: [],
                    otCity: [],
                    otState: [],
                    otCountry: [],
                    otAddress: [],
                    otPhone: [],
                    otZip: [],
                    otImgURL: [],
                    otReserveURL: [],
                    otLat: [],
                    otLong: []
                },
            };
            hotelFinal = {
                otId: [],
                otName: [],
                otCity: [],
                otState: [],
                otCountry: [],
                otAddress: [],
                otPhone: [],
                otZip: [],
                otImgURL: [],
                otReserveURL: [],
                otLat: [],
                otLong: [],
                otPrice: []
            };

            // Getting restaurants by city
            $.ajax({
                url: urlopentable, //API Call
                dataType: "json",
                type: "GET",
                async: false,
                data: {
                    city: opencity,
                    //zip: 32000,
                    //state: "CHH",
                    country: opencountry,
                    per_page: 50,
                    // appid: yelpkey,
                },
                success: function (opendata) {
                    console.log('Received Open Table: ', opendata);
                    if (opendata.total_entries > opendata.per_page) { x = opendata.per_page }
                    else { x = opendata.total_entries };

                    $.each(opendata.restaurants, function (index, val) {
                        var sttr = "hotelSummary.Price" + val.price + ".otId.push(val.id)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otName.push(val.name.substr(0,24))";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otCity.push(val.city)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otState.push(val.state)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otCountry.push(val.country)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otAddress.push(val.address)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otPhone.push(val.phone.substr(0,(val.phone.length - 1)))";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otZip.push(val.postal_code)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otImgURL.push(val.image_url)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otReserveURL.push(val.reserve_url)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otLat.push(val.lat)";
                        eval(sttr);
                        var sttr = "hotelSummary.Price" + val.price + ".otLong.push(val.lng)";
                        eval(sttr);
                    })
                }
            });

            console.log(hotelSummary);
            if (hotelSummary.Price5.otId.length > 6) { x5 = 6 }
            else { x5 = hotelSummary.Price5.otId.length }
            if (x5 < 6) {
                if (hotelSummary.Price4.otId.length > (6 - x5)) { x4 = (6 - x5) }
                else { x4 = hotelSummary.Price4.otId.length }
            }
            else { x4 = 0 }
            if ((x5 + x4) < 6) {
                if (hotelSummary.Price3.otId.length > (6 - (x5 + x4))) { x3 = (6 - (x4 + x5)) }
                else { x3 = hotelSummary.Price3.otId.length }
            }
            else { x3 = 0 }
            if ((x5 + x4 + x3) < 6) {
                if (hotelSummary.Price2.otId.length > (6 - (x5 + x4 + x3))) { x2 = (6 - (x3 + x4 + x5)) }
                else { x2 = hotelSummary.Price2.otId.length }
            }
            else { x2 = 0 }
            if ((x5 + x4 + x3 + x2) < 6) {
                if (hotelSummary.Price1.otId.length > (6 - (x5 + x4 + x3 + x2))) { x1 = (6 - (x2 + x3 + x4 + x5)) }
                else { x1 = hotelSummary.Price1.otId.length; }
            }
            else { x1 = 0 }

            //  Completing final object/array with only 5 restaurants
            for (x = 1; x < 6; x++) {
                var str = "x" + x;
                for (y = 0; y < eval(str); y++) {
                    var str2 = "hotelSummary.Price" + x + ".otName[" + y + "]";
                    hotelFinal.otName.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otId[" + y + "]";
                    hotelFinal.otId.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otCity[" + y + "]";
                    hotelFinal.otCity.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otState[" + y + "]";
                    hotelFinal.otState.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otCountry[" + y + "]";
                    hotelFinal.otCountry.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otAddress[" + y + "]";
                    hotelFinal.otAddress.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otPhone[" + y + "]";
                    hotelFinal.otPhone.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otZip[" + y + "]";
                    hotelFinal.otZip.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otImgURL[" + y + "]";
                    hotelFinal.otImgURL.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otReserveURL[" + y + "]";
                    hotelFinal.otReserveURL.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otLat[" + y + "]";
                    hotelFinal.otLat.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otLong[" + y + "]";
                    hotelFinal.otLong.push(eval(str2));
                    var str2 = "hotelSummary.Price" + x + ".otPrice[" + y + "]";
                    hotelFinal.otPrice.push(eval(x));
                }
            }

            var row8 = $("<tr>").append(
                $("<td>").text(hotelFinal.otName[0]),
                $("<td>").text(hotelFinal.otName[1]),
                $("<td>").text(hotelFinal.otName[2]),
                $("<td>").text(hotelFinal.otName[3]),
                $("<td>").text(hotelFinal.otName[4]),
                $("<td>").text(hotelFinal.otName[5]),
            );
            var icon7 = "<img src=" + hotelFinal.otImgURL[0] + " height=150px width=150px/>";
            var icon8 = "<img src=" + hotelFinal.otImgURL[1] + " height=150px width=150px/>";
            var icon9 = "<img src=" + hotelFinal.otImgURL[2] + " height=150px width=150px/>";
            var icon10 = "<img src=" + hotelFinal.otImgURL[3] + " height=150px width=150px/>";
            var icon11 = "<img src=" + hotelFinal.otImgURL[4] + " height=150px width=150px/>";
            var icon12 = "<img src=" + hotelFinal.otImgURL[5] + " height=150px width=150px/>";

            var row9 = $("<tr>").append(
                $("<td>").append(icon7),
                $("<td>").append(icon8),
                $("<td>").append(icon9),
                $("<td>").append(icon10),
                $("<td>").append(icon11),
                $("<td>").append(icon12),
            );
            var link1 = "<a href=" + hotelFinal.otReserveURL[0] + ">Link</a>";
            var link2 = "<a href=" + hotelFinal.otReserveURL[1] + ">Link</a>";
            var link3 = "<a href=" + hotelFinal.otReserveURL[2] + ">Link</a>";
            var link4 = "<a href=" + hotelFinal.otReserveURL[3] + ">Link</a>";
            var link5 = "<a href=" + hotelFinal.otReserveURL[4] + ">Link</a>";
            var link6 = "<a href=" + hotelFinal.otReserveURL[5] + ">Link</a>";

            var row10 = $("<tr>").append(
                $("<td>").append(link1),
                $("<td>").append(link2),
                $("<td>").append(link3),
                $("<td>").append(link4),
                $("<td>").append(link5),
                $("<td>").append(link6),
            );
            var row11 = $("<tr>").append(
                $("<td>").text("Phone: " + hotelFinal.otPhone[0]),
                $("<td>").text("Phone: " + hotelFinal.otPhone[1]),
                $("<td>").text("Phone: " + hotelFinal.otPhone[2]),
                $("<td>").text("Phone: " + hotelFinal.otPhone[3]),
                $("<td>").text("Phone: " + hotelFinal.otPhone[4]),
                $("<td>").text("Phone: " + hotelFinal.otPhone[5]),
            );

            $("#wrapper3").append(row8, row9, row10, row11);

            console.log("Final Array: ", hotelFinal);
            // $("#rImg1").attr("src", hotelFinal.otImgURL[0]);
            // $("#rImg2").attr("src", hotelFinal.otImgURL[1]);
            // $("#rImg3").attr("src", hotelFinal.otImgURL[2]);
            // $("#rImg4").attr("src", hotelFinal.otImgURL[3]);
            // $("#rImg5").attr("src", hotelFinal.otImgURL[4]);
            // $("#rImg6").attr("src", hotelFinal.otImgURL[5]);
            // $('#rName1').text(hotelFinal.otName[0]);
            // $('#rlink1').attr("href", hotelFinal.otReserveURL[0]);
            // $('#rphone1').text("Phone: " + hotelFinal.otPhone[0]);
            // $('#rName2').text(hotelFinal.otName[1]);
            // $('#rlink2').attr("href", hotelFinal.otReserveURL[1]);
            // $('#rphone2').text("Phone: " + hotelFinal.otPhone[1]);
            // $('#rName3').text(hotelFinal.otName[2]);
            // $('#rlink3').attr("href", hotelFinal.otReserveURL[2]);
            // $('#rphone3').text("Phone: " + hotelFinal.otPhone[2]);
            // $('#rName4').text(hotelFinal.otName[3]);
            // $('#rlink4').attr("href", hotelFinal.otReserveURL[3]);
            // $('#rphone4').text("Phone: " + hotelFinal.otPhone[3]);
            // $('#rName5').text(hotelFinal.otName[4]);
            // $('#rlink5').attr("href", hotelFinal.otReserveURL[4]);
            // $('#rphone5').text("Phone: " + hotelFinal.otPhone[4]);
            // $('#rName6').text(hotelFinal.otName[5]);
            // console.log(hotelFinal.otReserveURL[5]);
            // $('#rlink6').attr("href", hotelFinal.otReserveURL[5]);
            // $('#rphone6').text("Phone: " + hotelFinal.otPhone[5]);
        }




        $("#beerhunt").on("click", load_json_data('category'));

        function load_json_data(id, parent_id) {
            var html_code = '';
            $.getJSON('beers.json', function (data) {
                html_code += '<option value="">Select ' + id + '</option>';
                $.each(data, function (key, value) {
                    if (id == 'category') {
                        if (value.parent_id == '0') {
                            html_code += '<option value="' + value.id + '">' + value.name + '</option>';
                        }
                    }
                    else {
                        if (value.parent_id == parent_id) {
                            html_code += '<option value="' + value.id + '">' + value.name + '</option>';
                        }
                    }
                });
                $('#' + id).html(html_code);
            });
        }
        $(document).on('change', '#category', function () {
            var category_id = $(this).val();
            if (category_id != '') {
                load_json_data('type', category_id);
                //probando cambio de todo
                $('#brewery').html('<option value="">Select brewery</option>');
                $('#beer').html('<option value="">Select beer</option>');
            }
            else {
                $('#type').html('<option value="">Select type</option>');
                $('#brewery').html('<option value="">Select brewery</option>');
                $('#beer').html('<option value="">Select beer</option>');

            }
        });
        $(document).on('change', '#type', function () {
            var type_id = $(this).val();
            if (type_id != '') {
                load_json_data('brewery', type_id);
                $('#beer').html('<option value="">Select beer</option>');
            }
            else {
                $('#brewery').html('<option value="">Select brewery</option>');
                $('#beer').html('<option value="">Select beer</option>');
            }
        });
        $(document).on('change', '#brewery', function () {
            var type_id = $(this).val();
            if (type_id != '') {
                load_json_data('beer', type_id);

            }
            else {
                $('#beer').html('<option value="">Select beer</option>');
            }
        });
        $(document).on('change', '#beer', function () {
            var aux_id = $(this).val();
            console.log(aux_id);
            load_json_data('beer', aux_id);
            $('#results4').text(aux_id);
            $.getJSON("beers2.json", function (response) {
                var aux1 = aux_id - 1;
                var aux_beerId = response.data[aux1].beer_id;
                console.log(aux_beerId);
                console.log(response.data[aux1]);
                // $('#results4').text("Beer Selected: " + response.data[aux1].beer_id);
                $.getJSON("alldata.json", function (response) {
                    console.log(response);
                    console.log(response.data.length);
                    for (i = 0; i < response.data.length; i++) {
                        if (aux_beerId === response.data[i].id) {
                            console.log("Beer Name: " + response.data[i].name)
                            $("#results4").text("Beer Selected: " + response.data[i].name);
                            if (response.data[i].hasOwnProperty("labels")) {
                                $("#results4").append("<img src=" + response.data[i].labels.medium + ">");
                            }
                            else {
                                $("#results4").append("<p>No label to display</p>");
                            }
                            if (response.data[i].hasOwnProperty("description")) {
                                $("#results4").append("<p>Beer Description: " + response.data[i].description + "</p>");
                            }
                            else {
                                $("#results4").append("<p>Beer Description: Not available");
                            }
                            if (response.data[i].hasOwnProperty("style")) {
                                $("#results4").append("<p>Beer Category: " + response.data[i].style.category.name + "</p>");
                                $("#results4").append("<p>Beer Style: " + response.data[i].style.name + "</p>");
                                $("#results4").append("<p>Style description: " + response.data[i].style.description + "</p>");
                            }
                            else {
                                $("#results4").append("<p>Beer Category: Not available</p>");
                                $("#results4").append("<p>Beer Style: Not available</p>");
                                $("#results4").append("<p>Style description: Not available</p>");
                            }
                            if (response.data[i].hasOwnProperty("abv")) {
                                $("#results4").append("<p>Alcohol by volume: " + response.data[i].abv + "%</p>");
                            }
                            else {
                                $("#results4").append("<p>Alcohol by volume: Not available");
                            }
                            if (response.data[i].hasOwnProperty("available")) {
                                $("#results4").append("<p>Availability: " + response.data[i].available.name + "." + response.data[i].available.description + "</p>");
                            }
                            else {
                                $("#results4").append("<p>Availability: Not defined");
                            }

                        }
                    }


                })
            })
        })







        // Random

        // const apikeyBDB = "/?key=9968a2f544553322a8a49f3fb2916c09";
        // var baseURL = "https://sandbox-api.brewerydb.com/v2/";
        // var randomBeer = "beer/random";
        // var queryURLrandom = baseURL + randomBeer + apikeyBDB + "&withBreweries=Y";
        // console.log(queryURLrandom);
        // var locations = [];

        // $.ajax({
        //     url: queryURLrandom
        // })
        //     .done(function (response) {
        //         console.log(response);
        //         $("#results3").text("Beer Selected: " + response.data);
        //     })

    </script>


</body>

</html>